{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/data_schema/utils.ts","src://tavern_helper_template/src/data_schema/schema.ts","src://tavern_helper_template/src/data_schema/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","/**\n * 限制数值范围\n * @param {number} val - 默认数值\n * @param {number} min - 最小值\n * @param {number} max - 最大值\n */\nexport const clampedMum = (val, min, max) => z.coerce\n    .number()\n    .prefault(val)\n    .transform(val => _.clamp(val, min, max));\n/**\n * 数字取整并限制最小值\n * @param {number} val - 默认数值\n * @param {number} min - 最小值\n */\nexport const minLimitedNum = (val, min) => z.coerce\n    .number()\n    .prefault(val)\n    .transform(val => Math.max(Math.round(val), min));\n/**\n * 截取 record 的前 n 个条目\n * @param {Record<string, T>} record - 待截取的 record\n * @param {number} limit - 限制的条目数\n */\nconst sliceRecord = (record, limit) => _.fromPairs(_.take(_.toPairs(record), limit));\n/**\n * 任务 schema\n */\nexport const TaskSchema = z\n    .object({\n    简介: z.string().prefault(''),\n    目标: z.string().prefault(''),\n    奖励: z.string().prefault(''),\n})\n    .prefault({});\n/**\n * 货币 schema\n */\nexport const CurrencySchema = z\n    .object({\n    金币: minLimitedNum(0, 0),\n    银币: minLimitedNum(0, 0),\n    铜币: z.coerce.number().prefault(0).transform(Math.round),\n})\n    .prefault({});\n/**\n * 基础物品 schema\n */\nexport const BaseItemSchema = z.object({\n    品质: z.string().prefault(''),\n    类型: z.string().prefault(''),\n    标签: z.array(z.string()).optional(),\n    效果: z.record(z.string(), z.string()).prefault({}),\n    描述: z.string().prefault(''),\n});\n/**\n * 装备schema\n */\nexport const EquipmentSchema = BaseItemSchema.extend({\n    位置: z.string().prefault(''),\n});\n/**\n * 技能 schema\n */\nexport const SkillSchema = BaseItemSchema.extend({\n    消耗: z.string().prefault(''),\n}).transform(data => _.pick(data, ['品质', '类型', '消耗', '标签', '效果', '描述']));\n/**\n * 背包物品 schema\n */\nexport const InventoryItemSchema = BaseItemSchema.extend({\n    数量: z.coerce.number().prefault(1),\n}).transform(data => _.pick(data, ['品质', '类型', '数量', '标签', '效果', '描述']));\n/**\n * 基础属性 schema\n */\nconst DefaultAttr = {\n    力量: 0,\n    敏捷: 0,\n    体质: 0,\n    智力: 0,\n    精神: 0,\n};\nexport const BaseAttrSchema = z\n    .object(_.mapValues(DefaultAttr, () => z.coerce.number().prefault(0)))\n    .prefault({});\n/**\n * 登神长阶 schema\n *\n * 进阶逻辑（递归关系）：\n * - 3要素 → 合成1权能（清空要素）\n * - 2权能 → 合成1法则（清空权能）\n *\n * 状态约束：\n * - 有法则时：权能和要素永久清空，不可再获得\n * - 权能满2个时：要素清空，不可再获得\n * - 正常情况（权能<2 且 无法则）：可收集要素（最多3个）\n */\nexport const AscensionSchema = z\n    .object({\n    是否开启: z.boolean().prefault(false),\n    要素: z.record(z.string(), z.record(z.string(), z.string())).prefault({}),\n    权能: z.record(z.string(), z.record(z.string(), z.string())).prefault({}),\n    法则: z.record(z.string(), z.record(z.string(), z.string())).prefault({}),\n    神位: z.string().prefault(''),\n    神国: z\n        .object({\n        名称: z.string().prefault(''),\n        描述: z.string().prefault(''),\n    })\n        .prefault({}),\n})\n    .prefault({})\n    .transform(data => {\n    const LawNum = _.size(data.法则);\n    const powerNum = _.size(data.权能);\n    const powerLimit = 2;\n    const eleLimit = 3;\n    // 有法则：权能和要素永久清空\n    if (LawNum > 0) {\n        return {\n            ...data,\n            要素: {},\n            权能: {},\n            法则: data.神位 ? data.法则 : sliceRecord(data.法则, 1),\n        };\n    }\n    // 权能满上限：要素清空\n    if (powerNum >= powerLimit) {\n        return {\n            ...data,\n            要素: {},\n            权能: sliceRecord(data.权能, powerLimit),\n            法则: sliceRecord(data.法则, 1),\n        };\n    }\n    // 无权能且无法则：正常收集要素\n    return {\n        ...data,\n        要素: sliceRecord(data.要素, eleLimit),\n        权能: sliceRecord(data.权能, powerLimit),\n        法则: {},\n    };\n});\n/**\n * 通用角色身份信息 schema\n */\nexport const IdentitySchema = z.object({\n    等级: clampedMum(1, 1, 25),\n    生命层级: z.string().prefault(''),\n    种族: z.string().prefault(''),\n    身份: z.array(z.string()).prefault([]),\n    职业: z.array(z.string()).prefault([]),\n    属性: BaseAttrSchema,\n    装备: z.record(z.string(), EquipmentSchema).prefault({}),\n    技能: z.record(z.string(), SkillSchema).prefault({}),\n    登神长阶: AscensionSchema,\n});\n","import { clampedMum, CurrencySchema, IdentitySchema, InventoryItemSchema, minLimitedNum, TaskSchema, } from './utils';\n/**\n * 玩家信息\n */\nconst player = z\n    .object({\n    ...IdentitySchema.shape,\n    累计经验值: z.coerce.number().prefault(0),\n    升级所需经验: z.coerce.number().prefault(23),\n    冒险者等级: z.string().prefault('未评级'),\n    生命值: z.coerce.number().prefault(0),\n    生命值上限: z.coerce.number().prefault(0),\n    法力值: z.coerce.number().prefault(0),\n    法力值上限: z.coerce.number().prefault(0),\n    体力值: z.coerce.number().prefault(0),\n    体力值上限: z.coerce.number().prefault(0),\n    属性点: z.coerce.number().prefault(0),\n    背包: z\n        .record(z.string(), InventoryItemSchema)\n        .prefault({})\n        .transform(items => _.pickBy(items, item => item.数量 > 0)),\n    金钱: CurrencySchema,\n    任务: z.record(z.string(), TaskSchema).prefault({}),\n})\n    .prefault({})\n    .transform(data => {\n    const processed = {\n        ...data,\n        升级所需经验: data.等级 >= 25 ? 'MAX' : data.升级所需经验,\n        生命值: _.clamp(data.生命值, 0, data.生命值上限),\n        法力值: _.clamp(data.法力值, 0, data.法力值上限),\n        体力值: _.clamp(data.体力值, 0, data.体力值上限),\n    };\n    return _.pick(processed, [\n        // 基础信息\n        '种族',\n        '身份',\n        '职业',\n        '生命层级',\n        // 等级系统\n        '等级',\n        '累计经验值',\n        '升级所需经验',\n        '冒险者等级',\n        // 属性点（在属性前面）\n        '属性点',\n        // 属性\n        '属性',\n        // 资源值\n        '生命值上限',\n        '生命值',\n        '法力值上限',\n        '法力值',\n        '体力值上限',\n        '体力值',\n        // 物品与货币\n        '金钱',\n        '背包',\n        // 装备、技能、登神长阶\n        '装备',\n        '技能',\n        '登神长阶',\n        // 任务系统\n        '任务',\n    ]);\n});\n/**\n * 命定之人信息\n */\nconst partners = z\n    .record(z.string(), z\n    .object({\n    ...IdentitySchema.shape,\n    是否在场: z.boolean().prefault(false),\n    性格: z.string().prefault(''),\n    喜爱: z.string().prefault(''),\n    外貌: z.string().prefault(''),\n    着装: z.string().prefault(''),\n    是否缔结契约: z.boolean().prefault(false),\n    好感度: clampedMum(0, -100, 100),\n    心里话: z.string().prefault(''),\n    背景故事: z.string().prefault(''),\n})\n    .prefault({})\n    .transform(data => _.pick(data, [\n    // 状态信息\n    '是否在场',\n    // 基础信息\n    '种族',\n    '身份',\n    '职业',\n    '生命层级',\n    // 外貌特征\n    '性格',\n    '喜爱',\n    '外貌',\n    '着装',\n    // 等级\n    '等级',\n    // 属性\n    '属性',\n    // 装备、技能、登神长阶\n    '装备',\n    '技能',\n    '登神长阶',\n    // 关系信息\n    '是否缔结契约',\n    '好感度',\n    // 故事信息\n    '心里话',\n    '背景故事',\n])))\n    .prefault({});\n/**\n * 新闻信息\n */\nconst news = z.object({\n    阿斯塔利亚快讯: z\n        .object({\n        势力要闻: z.string().prefault(''),\n        尊位行迹: z.string().prefault(''),\n        军事行动: z.string().prefault(''),\n        经济动脉: z.string().prefault(''),\n        灾害预警: z.string().prefault(''),\n    })\n        .prefault({}),\n    酒馆留言板: z\n        .object({\n        高额悬赏: z.string().prefault(''),\n        冒险发现: z.string().prefault(''),\n        怪物异动: z.string().prefault(''),\n        通缉要犯: z.string().prefault(''),\n        宝物传闻: z.string().prefault(''),\n    })\n        .prefault({}),\n    午后茶会: z\n        .object({\n        社交逸闻: z.string().prefault(''),\n        千里远望: z.string().prefault(''),\n        命运涟漪: z.string().prefault(''),\n        邂逅预兆: z.string().prefault(''),\n    })\n        .prefault({}),\n});\nexport const Schema = z.object({\n    事件: z.record(z.any(), z.any()).prefault({}),\n    世界: z\n        .object({\n        时间: z.string().prefault(''),\n        地点: z.string().prefault(''),\n    })\n        .prefault({}),\n    主角: player.prefault({}),\n    命定系统: z\n        .object({\n        命运点数: minLimitedNum(0, 0),\n        命定之人: partners,\n    })\n        .prefault({}),\n    新闻: news.prefault({}),\n});\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\n\nimport { Schema } from './schema.ts';\n\n$(() => {\n  registerMvuSchema(Schema);\n});\n"],"names":["z","clampedMum","val","min","max","coerce","number","prefault","transform","_","clamp","minLimitedNum","Math","round","sliceRecord","record","limit","fromPairs","take","toPairs","TaskSchema","object","string","CurrencySchema","BaseItemSchema","array","optional","EquipmentSchema","extend","SkillSchema","data","pick","InventoryItemSchema","BaseAttrSchema","mapValues","AscensionSchema","boolean","LawNum","size","powerNum","IdentitySchema","player","shape","items","pickBy","item","processed","partners","news","Schema","any","$"],"ignoreList":[],"sourceRoot":""}